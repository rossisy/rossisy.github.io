---
layout: post
title: "RAID"
date: 2019-01-24 10:00:00 +0800
categories: Linux 
---

# 什么是RAID
磁盘阵列的英文全名是RedundantArrays of Inexpensive Disks（RAID），即容错廉价磁盘阵列。RAID可以通过一些技术（软件或硬件）将多个较小的磁盘整合成为一个较大的磁盘设备；而这个较大的磁盘功能可不止是存储，还具有数据保护的功能，整个RAID由于选择的等级（level）不同，而使得整合后的磁盘具有不同的功能。

## RAID等级

### RAID-0（等量模式，stripe）：性能最佳
这种模式使用相同型号与容量的磁盘来组成时，效果较佳。这种模式的RAID会将磁盘先切出等量的区块，当文件要写入RAID时，该文件会依据块的大小切割好，之后再依次放到各个磁盘里面去。由于每个磁盘会交错存放数据，因此当你的数据要写入RAID时，数据会被等量放置在各个磁盘上面。因此，越多块磁盘组成的RAID-0性能会越好，因为每块负责的数据量就更低了，这表示我的数据可以分散让多块磁盘来存储，当然性能会变得更好。此外，磁盘总容量也变大了。

### RAID-1（映像模式，mirror）：完整备份
这种模式也是需要相同的磁盘容量，最好是一模一样的磁盘。如果是不同容量的磁盘组成RAID-1时，那总容量将以最小的那一块磁盘为主！这种模式主要是让同一份数据完整保存在两块磁盘上面。由于两块硬盘内容一模一样，像镜子映照出来一样，所以也称它为mirror（镜像）模式。RAID-1最大的优点就在于数据的备份，不过也因为磁盘容量有一半用在备份，因此总容量是全部磁盘容量的一半而已。虽然RAID-1的写入性能不佳，不过读取的性能则还可以。这是因为数据有两份在不同的磁盘上面，如果多个进程在读取同一条数据时，RAID会自行取得最佳的读取平衡。

### RAID 0+1，RAID 1+0
RAID-0的性能佳但是数据不安全，RAID-1的数据安全但是性能不佳，可以将这两者整合起来设置RAID，即RAID 0+1或RAID 1+0。所谓的RAID 0+1就是先让两块磁盘组成RAID 0，并且这样的设置共有两组；然后将这两组RAID 0再组成一组RAID 1。这就是RAID 0+1。反过来说，RAID 1+0就是先组成RAID 1再组成RAID 0的意思。

### RAID 5：性能与数据备份的均衡考虑
RAID 5至少需要三块以上的磁盘才能够组成这种类型的磁盘阵列。这种磁盘阵列的数据写入有点类型RAID 0，不过每个循环的写入过程中，在每块磁盘还加入一个同位检查数据（Parity），这个数据会记录其他磁盘的备份数据，用于当有磁盘损毁时的救援。由于有同位检查码，因此RAID 5的总容量会是整体磁盘数量减一块。在读写性能的比较上，读取的性能还不赖，与RAID 0有得比，不过写的性能就不见得能增加很多，这是因为要写入RAID 5的数据还得要经过计算同位检查码的关系。由于加上这个计算的操作，所以写入的性能与系统的硬件关系较大。尤其当使用软件磁盘阵列时，同位检查码是通过CPU去计算而非专门的磁盘阵列卡，因此性能方面还需要评估。
另外，由于RAID 5仅能支持一块磁盘的损毁，因此近来还发展出另外一种等级，就是RAID 6，这个RAID 6则使用两块磁盘的容量作为同位检查码的存储，因此整体的磁盘容量就会少于两块，但是允许出错的磁盘数量就可以达到两块了。

### Spare Disk：预备磁盘的功能
当磁盘阵列的磁盘损毁时，就得要讲坏掉的磁盘拔除，然后换一块新的磁盘。换成新磁盘并且顺利启动磁盘阵列后，磁盘阵列就会开始主动重建原本坏掉的那块磁盘数据到新的磁盘上。这就是磁盘阵列的优点，不过，我们还是得要动手拔插硬盘，此时通常得要关机才能这么做。
为了让系统可以实时地在坏掉硬盘时主动重建，因此就需要预备磁盘的辅助，所谓的spare disk就是一块或多块没有包含在原本磁盘阵列等级中的磁盘，这块磁盘平时并不会被磁盘阵列所使用，当磁盘阵列有任何磁盘损毁时，则这块spare disk会被主动拉进磁盘阵列中，并将坏掉的那块硬盘移出磁盘阵列，然后立即重建数据系统。

## 磁盘阵列的优点
数据安全与可靠性：指的并非信息安全，而是当硬件损毁时，数据是否还能安全救援或使用之意
读写性能：例如RAID 0可以加强读写性能，让你的系统I/O部分得以改善
容量：可以让多块磁盘组合起来，故单一文件系统可以有相当大的容量

# software, hardware RAID
所谓的硬件磁盘阵列是通过磁盘阵列卡来完成的，磁盘阵列卡上面有一块专门的芯片在处理RAID的任务，因此在性能方面会比较好。利用软件来仿真磁盘阵列的功能，就是所谓的软件磁盘阵列。

